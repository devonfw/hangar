# Mandatory flags.
mandatoryFlags="$pipelineName,$localDirectory,$language,$buildPipelineName,$sonarUrl,$sonarToken,$testPipelineName,"
# Path to the templates.
templatesPath="scripts/pipelines/azure-devops/templates/allInOne"
# Path to the common templates folder
commonTemplatesPipelinePath="scripts/pipelines/common/templates/allInOne"
# YAML file name.
yamlFile="allInOne-pipeline.yml"
# Script name.
scriptFile="allInOne.sh"
# Source branch.
sourceBranch="feature/allInOne-pipeline"

# Function that copies the script to build, test and check quality of the application.
function copyScript {
    # Copy the script.
    cp "${hangarPath}/${commonTemplatesPipelinePath}/${language}-${scriptFile}" "${localDirectory}/${scriptFilePath}/${scriptFile}"
}

# Function that adds the variables to be used in the pipeline.
function addPipelineVariables {
    # if the user did not specify a custom target-directory
    # we default to the language specific defaults
    if test -z $targetDirectory
    then
        setTargetDirectory
    fi

    # Add the name of the build pipeline name variable.
    az pipelines variable create --name "buildPipelineName" --pipeline-name $pipelineName --value ${buildPipelineName}
    # Add the name of the test pipeline name variable.
    az pipelines variable create --name "testPipelineName" --pipeline-name $pipelineName --value ${testPipelineName}
    # Add sonar credentials.
    az pipelines variable create --name "sonarUrl" --pipeline-name $pipelineName --value ${sonarUrl}
    az pipelines variable create --name "sonarToken" --pipeline-name $pipelineName --value ${sonarToken} --secret true
    # Add target directory
    az pipelines variable create --name "targetPath" --pipeline-name "${pipelineName}" --value "${targetDirectory}"
}